<!DOCTYPE html><html lang="en">
    <head>
<meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0 user-scalable=no"/>
        <title>Working in Progress</title>
        <link rel="stylesheet" href="/css/main.css"/>
        <link rel="stylesheet" href="/css/zenburn.css"/>
        
        
    </head><body class="is-preload">
        <div id="wrapper">
            <div id="main">
                <div class="inner">
                    <header id="header">
                        <a href="/index.html" class="logo">
                            <strong>
                                WORKING IN PROGRESS
                            </strong> - POST
                        </a><ul class="icons">
                            <li>
                                <a href="https://twitter.com/marioggar" class="icon fa-twitter">
                                    <span class="label">
                                        Twitter
                                    </span>
                                </a>
                            </li><li>
                                <a href="https://github.com/mariogarcia" class="icon fa-github">
                                    <span class="label">
                                        Github
                                    </span>
                                </a>
                            </li>
                        </ul>
                    </header><section><header class="main"><div class="metadata"><em class="fa fa-calendar-o"></em><b>2020-10-18</b></div><h1>DS - Basic stocks charts</h1></header><yieldScaped><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>A good way of practicing matplotlib is trying to mimic examples out there. Trading is one of those areas where charts are broadly used. I&#8217;ve checked several articles (I&#8217;ll leave the reference in the resources area) to see which ones are the most popular and then try to reproduce them using matplotlib and maybe learning something about stock analysis in the process.</p>
</div>
<div class="paragraph">
<p>All the examples in this article have been created using a Jupyter notebook. You can find the source code of the notebook <a href="/files/2020/10/chart_stocks/ua_analysis.ipynb">here</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="a_little_bit_about_indicators">A little bit about indicators</h2>
<div class="sectionbody">
<div class="paragraph">
<p>After spending an hour trying to get a simple listing of what are the most common financial indicators, I kind of came up with the following summary. There&#8217;re two main types of financial indicators, <strong>lagging</strong> indicators and <strong>leading indicators</strong>. <strong>Lagging indicators</strong> are normally used by traders to know when to enter or exit a given value, whereas a <strong>leading indicator</strong> would normally used to guess where the prices of a given stock are going to go.</p>
</div>
<div class="paragraph">
<p>I&#8217;ve also found another classification based on the required information the trader needs at a given time of the process, here&#8217;s a summarized table:</p>
</div>
<table class="tableblock frame-all grid-all stretch compressed">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">TOPIC</th>
<th class="tableblock halign-center valign-top">TYPE</th>
<th class="tableblock halign-center valign-top">CHART</th>
<th class="tableblock halign-left valign-top">EVALUATES&#8230;&#8203;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Trend</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">LAGGING</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#trend_50_and_200_day_ema">50 and 200-day EMA</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">how the market is moving (up, down, stays still)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Mean</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">LAGGING</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#mean_bollinger_bands">Bollinger Bands</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">how far the price is going before changing direction</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Relative strength</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">LEADING</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#relative_strength_stochastic_oscillator_so">Stochastics</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oscilations in buying and selling pressure</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Momentum</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">LEADING</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#momentum_macd">MACD</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">the speed of price change over time</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Volume</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">LEADING / LAGGING</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><a href="#volume_on_balance_volume_obv">On-Balance-Volume (OBV)</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">whether traders are cautious or greedy</p></td>
</tr>
</tbody>
</table>
<div class="sect2">
<h3 id="resources">Resources</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.investopedia.com/articles/active-trading/011815/top-technical-indicators-rookie-traders.asp">Top Technical Indicators for Rookie Traders</a></p>
</li>
<li>
<p><a href="https://www.dailyfx.com/education/technical-analysis-tools/leading-vs-lagging-indicators.html">Leading vs Lagging indicators</a></p>
</li>
<li>
<p><a href="https://www.investopedia.com/terms/l/leadingindicator.asp">Leading indicator</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="getting_the_data">Getting the data</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://github.com/ranaroussi/yfinance">Yfinance</a> is a Python library which uses the Yahoo Finance API to access stock related information. There&#8217;re thousands of stock values out there, in this ocasion I&#8217;m getting Under Armour last year values.</p>
</div>
<div class="listingblock">
<div class="title">Getting last year data</div>
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import yfinance

(yfinance
    .Ticker("UA")                # interested in UA
    .history(period="1y")        # downloads last year
    .to_csv('/tmp/ua_1y.csv'))   # saves de DataFrame as a csv file</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then I&#8217;m creating a Jupyter notebook where I&#8217;m importing the csv to analyze the data and create the chart with the indicators.</p>
</div>
<div class="listingblock">
<div class="title">loading csv with stock prices</div>
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import pandas as pd

ua = pd.read_csv('ua_1y.csv')
ua.head()</code></pre>
</div>
</div>
<div class="paragraph">
<p>First I&#8217;m creating a line chart with all the loaded prices:</p>
</div>
<div class="listingblock">
<div class="title">stock prices with matplotlib</div>
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import numpy as np
import matplotlib.pyplot as plt
import matplotlib.dates as mdates

xs = pd.to_datetime(ua['Date'])
ys = ua['Close']

def base_plot():
    plt.plot(xs, ys)
    plt.title('UNDER ARMOUR STOCK PRICES (OCT-2019 - OCT-2020)')
    plt.ylabel('PRICE (US Dollars)')
    plt.yticks(np.arange(np.floor(ys.min()) - 2, np.ceil(ys.max()) + 4, step=2))

    xaxis = plt.gca().xaxis
    xaxis.set_major_locator(mdates.MonthLocator())
    xaxis.set_major_formatter(mdates.DateFormatter('%b'))

    plt.margins(x=0)

base_plot()</code></pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/img/2020/10/chart_stocks/prices.png" alt="prices_only" width="90%">
</div>
<div class="title">Figure 1. Line chart showing only stock prices (YDT)</div>
</div>
<div class="sect2">
<h3 id="resources_2">Resources</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/ranaroussi/yfinance">YFinance</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="trend_50_and_200_day_ema">Trend: 50 and 200-day EMA</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="#a_little_bit_about_indicators">Back to indicators index</a></p>
</div>
<div class="paragraph">
<p>Following the table I mentioned in the beginning, I&#8217;m starting to draw both the 50 and 200-day EMA to see how the market is behaving about this stock value. EMA stands for <strong>exponential moving average</strong> and it&#8217;s supposed to be more responsive than the simple moving averages. Depending on whether we&#8217;re looking for medium of long term we would be using the 50 or the 200 days EMA.</p>
</div>
<div class="paragraph">
<p>How to calculate the EMA using Pandas ? Well, there&#8217;s the <strong>ewm</strong> function to precisely calculate functions in an exponential window. So</p>
</div>
<div class="listingblock">
<div class="title">calculating 50 and 200-day EMA</div>
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">ua['EMA 50']  = ua['Close'].ewm(span=50).mean()
ua['EMA 200'] = ua['Close'].ewm(span=200).mean()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then is simply about plotting both dates as x values and EMAs as y values:</p>
</div>
<div class="listingblock">
<div class="title">drawing EMA-50 &amp; EMA-200</div>
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">plt.figure(figsize=(15, 5))

# PRICE LINES
base_plot()

# EMA LINES
plt.plot(xs, ua['EMA 50'], color='green')
plt.plot(xs, ua['EMA 200'], color='red')

# INSERSECTIONS
idx = np.argwhere(np.diff(np.sign(ua['EMA 50'] - ua['EMA 200']))).flatten()
plt.scatter(xs[idx], ua['EMA 50'].iloc[idx], s=200, color='w', edgecolor='black', linewidths=1)

# LEGEND
plt.legend(['Price', 'EMA 50', 'EMA 200', 'EMAs intersections'], frameon=False)

plt.show()</code></pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/img/2020/10/chart_stocks/ema.png" alt="ema" width="90%">
</div>
<div class="title">Figure 2. EMA-50 and EMA-200 (YDT)</div>
</div>
<div class="paragraph">
<p>There&#8217;s a few of strategies based on the relationship between the EMA and the price lines, and also between fast and slow EMAs. First it seems that when the price is above the EMA line, the price is likely to go up whereas when it&#8217;s below, it&#8217;s likely to fall. Because of that EMAs have been also been used visually as support and resistance bands.</p>
</div>
<div class="paragraph">
<p>But there&#8217;s also a relationship worth mentioning, the <a href="https://corporatefinanceinstitute.com/resources/knowledge/trading-investing/how-to-read-stock-charts/">relationship between the 50 and 200 EMAs</a>. This theory says that when the EMA-50 crosses from below to above the EMA-200 is an indicator that the prices are going to rise. However when the EMA-50 crosses from above to below the EMA-200 it&#8217;s an indicator that the prices are going to decrease. <strong>I&#8217;ve highlighted these intersections in the chart</strong> with the following code:</p>
</div>
<div class="listingblock">
<div class="title">EMAs intersections</div>
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">idx = np.argwhere(np.diff(np.sign(ua['EMA 50'] - ua['EMA 200']))).flatten()
plt.scatter(
    xs[idx],
    ua['EMA 50'].iloc[idx],
    s=200,
    color='w',
    edgecolor='black',
    linewidths=1)</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="resources_3">Resources</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://corporatefinanceinstitute.com/resources/knowledge/trading-investing/exponential-moving-average-ema/">Exponential moving averages</a></p>
</li>
<li>
<p><a href="https://corporatefinanceinstitute.com/resources/knowledge/trading-investing/how-to-read-stock-charts/">How to read stock charts</a></p>
</li>
<li>
<p><a href="https://stackoverflow.com/questions/28766692/intersection-of-two-graphs-in-python-find-the-x-value">Calculate intersection of two graphs with Python</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="mean_bollinger_bands">Mean: Bollinger Bands &#169;</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="#a_little_bit_about_indicators">Back to indicators index</a></p>
</div>
<div class="paragraph">
<p>One of the most famous indicators in financial analysis is the Bollinger Bands &#169;. Create by <a href="https://en.wikipedia.org/wiki/Bollinger_Bands">John Bollinger</a>  in the 1980s to help traders to know when prices are likely to change direction there&#8217;re some indicators. It&#8217;s composed by three bands, the moving average (middle band), upper and lower Bollinger bands.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>typical price</strong>: is the average of adding up open, close, and highest price</p>
</li>
<li>
<p><strong>ma</strong> is a simple moving average of the <strong>typical price</strong> (typically for 20 days)</p>
</li>
<li>
<p><strong>n</strong> is the number of standard deviations (typically 2)</p>
</li>
<li>
<p><strong>std</strong> is standard deviation over a period of time</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/img/8292af34bd5f286d293d3534cc16d910.png" alt="8292af34bd5f286d293d3534cc16d910.png" height="30">
</div>
<div class="title">Figure 3. moving average</div>
</div>
<div class="listingblock">
<div class="title">typical price, moving average and standard deviation</div>
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">ua['Typical Price'] = (ua['Open'] + ua['Close'] + ua['High']) / 3

ua['MA 20']    = ua['Typical Price'].rolling(window=20).mean()
ua['STD 20']   = ua['Typical Price'].rolling(window=20).std()</code></pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/img/d9d8b7c979e54c7164e3a66dd0d2d1f3.png" alt="d9d8b7c979e54c7164e3a66dd0d2d1f3.png" height="30">
</div>
<div class="title">Figure 4. upper bands</div>
</div>
<div class="listingblock">
<div class="title">upper bands calculation</div>
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">ua['UpperBol'] = ua['MA 20'] + (2 * ua['STD 20'])</code></pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/img/d4bc7f387b4e9108da8873a95b1b1fcd.png" alt="d4bc7f387b4e9108da8873a95b1b1fcd.png" height="30">
</div>
<div class="title">Figure 5. lower band</div>
</div>
<div class="listingblock">
<div class="title">lower band calculation</div>
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">ua['LowerBol'] = ua['MA 20'] - (2 * ua['STD 20'])</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can draw the three bands along with the price band:</p>
</div>
<div class="listingblock">
<div class="title">Drawing Bollinger bands &#169;</div>
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">plt.figure(figsize=(15, 5))

base_plot() # PRICE PLOT

plt.plot(xs, ua['MA 20'], color='orange')     # MIDDLE BAND
plt.plot(xs, ua['UpperBol'], color='orange')  # UPPER BAND
plt.plot(xs, ua['LowerBol'], color='orange')  # LOWER BAND

plt.legend(['Price', 'Bollinger Bands'])

plt.fill_between(xs, ua['UpperBol'], ua['LowerBol'], color='yellow', alpha=0.2)
plt.show()</code></pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/img/2020/10/chart_stocks/bollinger.png" alt="bollinger" width="90%">
</div>
<div class="title">Figure 6. Bollinger upper and lower bands</div>
</div>
<div class="paragraph">
<p>Here the idea is that when the price is continuously touching the upper band, that&#8217;s a signal that the price is overbought, whereas when the price is continuosly touching the lower band that means that the price is oversold:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Price <strong>overbought</strong>: price touching continuosly the upper band</p>
</li>
<li>
<p>Price <strong>oversold</strong>: price touching continuosly the lower band</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There&#8217;re more information on how to use this indicator in the resources section.</p>
</div>
<div class="sect2">
<h3 id="resources_4">Resources</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://en.wikipedia.org/wiki/Bollinger_Bands">Bollinger bands &#169; (Wikipedia)</a></p>
</li>
<li>
<p><a href="https://www.investopedia.com/articles/technical/102201.asp">The basics of the Bollinger bands &#169;</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="relative_strength_stochastic_oscillator_so">Relative strength: Stochastic Oscillator (SO)</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="#a_little_bit_about_indicators">Back to indicators index</a></p>
</div>
<div class="paragraph">
<p>When measuring the relative strenght of the price we&#8217;d like to know <strong>if there&#8217;s going to be a significant oscillation</strong> in the buying or selling pressure. The <strong>stochastic oscillator</strong> attempts to predict price turning points by comparing the closing price of a stock value to its price range. The formula is:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/img/903fb9f2c123ccf23354382fb6ed05e3.png" alt="903fb9f2c123ccf23354382fb6ed05e3.png" height="60">
</div>
<div class="title">Figure 7. Stochastic Oscillator (SO)</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>SO</strong>: Stochastic oscillator</p>
</li>
<li>
<p><strong>CP</strong>: Closing price</p>
</li>
<li>
<p><strong>LP14</strong>: Lowest price of the previous 14 trading days</p>
</li>
<li>
<p><strong>HP14</strong>: Highest price of the previous 14 trading days</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In Pandas the only mistery is to calculate the lowest and highest price of the previous 14 trading days and then fill the formula in another DataFrame column.</p>
</div>
<div class="listingblock">
<div class="title">Calculate lowest/highest price in a 14-day window</div>
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">ua['L14'] = ua['Low'].rolling(14).min()
ua['H14'] = ua['High'].rolling(14).max()

ua['SO'] = ((ua['Close'] - ua['L14']) / (ua['H14'] - ua['L14'])) * 100</code></pre>
</div>
</div>
<div class="paragraph">
<p>The SO is not meant to be shown over the price plot. You normally see it side by side as a different chart at the bottom of the stock prices chart.</p>
</div>
<div class="listingblock">
<div class="title">Drawing both prices and SO charts</div>
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python"># DRAWING SO
from matplotlib.gridspec import GridSpec
import matplotlib.patches as mpatches

# GRID TO LOCATE PRICE AND SO CHARTS
fig = plt.figure(figsize=(15, 5))
gsp = GridSpec(2, 1, height_ratios=[4, 3], hspace=0)

ax1 = fig.add_subplot(gsp[0])
ax2 = fig.add_subplot(gsp[1], sharex=ax1)

# PRICE CHART
ax1.plot(xs, ys, label='Price', color="blue")
ax1.set_title('UNDER ARMOUR STOCK PRICES (OCT-2019 - OCT-2020)')
ax1.set_ylabel('PRICE (US Dollars)')
ax1.set_yticks(np.arange(np.floor(ys.min()) - 2, np.ceil(ys.max()) + 4, step=2))
ax1.set_xticks([])
ax1.grid(axis='x', linestyle='--')

# SO CHART
xaxis = ax2.xaxis
xaxis.set_major_locator(mdates.MonthLocator())
xaxis.set_major_formatter(mdates.DateFormatter('%b'))

ax2.plot(xs, ua['SO'], color='red', linestyle='-')
ax2.grid(axis='x', linestyle='--')

# HIDDING LAST Y TICKS IN SO CHART
ax2.set_yticks(np.arange(0, 200, step=50))
ax2.set_ylim(0, 150)
plt.setp(ax2.get_yticklabels()[-1], visible=False)

# COMBINED LEGEND
prices_patch = mpatches.Patch(color='blue', label='Prices')
stocha_patch = mpatches.Patch(color='red', label='Stochastic')
ax1.legend(handles=[prices_patch, stocha_patch])
plt.show()</code></pre>
</div>
</div>
<div class="paragraph">
<p>As a rule of thumb, most of the sources say that values over 80% are considered overbought whereas values below 20% are considered oversold.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/img/2020/10/chart_stocks/stochastic.png" alt="stochastic" width="90%">
</div>
<div class="title">Figure 8. Stochastic Oscillator (YDT)</div>
</div>
<div class="sect2">
<h3 id="resources_5">Resources</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.investopedia.com/terms/s/stochasticoscillator.asp">Stocastic Oscillator</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="momentum_macd">Momentum: MACD</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="#a_little_bit_about_indicators">Back to indicators index</a></p>
</div>
<div class="paragraph">
<p>The MACD is another <strong>trending indicator</strong>. It&#8217;s the difference between a 12 period EMA minus a 26 period EMA. It&#8217;s normally shown together with the MACD SIGNAL and a MACD histogram.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/img/6ea356b6da058c337c76ae975135a6d4.png" alt="6ea356b6da058c337c76ae975135a6d4.png" width="300">
</div>
<div class="title">Figure 9. MACD</div>
</div>
<div class="listingblock">
<div class="title">MACD calculationn</div>
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">ua['EMA 26']      = ua['Close'].ewm(span=26).mean()
ua['EMA 12']      = ua['Close'].ewm(span=12).mean()

ua['MACD']        = ua['EMA 12'] - ua['EMA 26']</code></pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/img/e179328a8e6c82fc33673f1165be1429.png" alt="e179328a8e6c82fc33673f1165be1429.png" width="300">
</div>
<div class="title">Figure 10. MACD signal</div>
</div>
<div class="listingblock">
<div class="title">MACD signal calculation</div>
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">ua['MACD SIGNAL'] = ua['MACD'].ewm(span=9).mean()</code></pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/img/db7dfbba912ae3d2518e351eee59fd42.png" alt="db7dfbba912ae3d2518e351eee59fd42.png" width="300">
</div>
<div class="title">Figure 11. MACD histogram</div>
</div>
<div class="listingblock">
<div class="title">MACD histogram calculation</div>
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">ua['MACD HIST'] = ua['MACD'] - ua['MACD SIGNAL']</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Drawing MACD</div>
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import matplotlib.ticker as ticker

from matplotlib.gridspec import GridSpec
import matplotlib.patches as mpatches

# GRID TO LOCATE PRICE AND SO CHARTS
sto = plt.figure(figsize=(15, 5))
gsp = GridSpec(2, 1, height_ratios=[4, 3], hspace=0)

st1 = sto.add_subplot(gsp[0])
st2 = sto.add_subplot(gsp[1], sharex=st1)

# USING A NORMALIZED X AXIS TICKS
thex = np.arange(len(ua))

# DRAWING PRICE CHART
st1.plot(thex, ys, label='Price', color="blue")
st1.set_title('UNDER ARMOUR STOCK PRICES (OCT-2019 - OCT-2020)')
st1.set_ylabel('PRICE (US Dollars)')
st1.set_yticks(np.arange(np.floor(ys.min()) - 2, np.ceil(ys.max()) + 4, step=2))
st1.grid(axis='x', linestyle='--')

# DRAWING MACD CHART
st2.plot(thex, ua['MACD'], color='blue')
st2.plot(thex, ua['MACD'], color='blue')
st2.plot(thex, ua['MACD SIGNAL'], color='red')

pos_his1 = ua.loc[ua['MACD HIST'] &gt; 0.2]
pos_his2 = ua.loc[(ua['MACD HIST'] &gt;= 0.0) &amp; (ua['MACD HIST'] &lt;= 0.2)]

neg_his1 = ua.loc[(ua['MACD HIST'] &lt; 0) &amp; (ua['MACD HIST'] &gt;= -0.1)]
neg_his2 = ua.loc[ua['MACD HIST'] &lt; -0.1]

st2.bar(pos_his1.index, pos_his1['MACD HIST'], width=0.6, color='#77af70')
st2.bar(pos_his2.index, pos_his2['MACD HIST'], width=0.6, color='#ace6cb')
st2.bar(neg_his1.index.values, neg_his1['MACD HIST'], width=0.6, color='#dababa')
st2.bar(neg_his2.index.values, neg_his2['MACD HIST'], width=0.6, color='#b92f2f')

st2.xaxis.set_major_formatter(ticker.FuncFormatter(lambda x, pos: ua.iloc[pos, 0]))

st2.grid(axis='x', linestyle='--')
plt.show()</code></pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/img/2020/10/chart_stocks/macd.png" alt="macd" width="90%">
</div>
<div class="title">Figure 12. MACD YTD</div>
</div>
<div class="paragraph">
<p>One way of using the MACD is noticing that when the <strong>MACD crosses above the signal it&#8217;s telling the traders is a good moment to buy</strong> whereas <strong>when the MACD crosses below the signal it&#8217;s a good moment to sell</strong>. Of course this also depends on the trading strategy of everyone.</p>
</div>
<div class="sect2">
<h3 id="resources_6">Resources</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://school.stockcharts.com/doku.php?id=technical_indicators:moving_average_convergence_divergence_macd">Calculate moving averages</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="volume_on_balance_volume_obv">Volume: On-Balance-Volume (OBV)</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="#a_little_bit_about_indicators">Back to indicators index</a></p>
</div>
<div class="paragraph">
<p>Finally here&#8217;s the last indicator to create. The On-Balance-Volume is another trending indicator. It&#8217;s normally used to know if there&#8217;re many traders jumping in or jumping out of a given value. The formula of the OBV:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/img/dd9c36e978dabaf826a5f46b5525aaaa.png" alt="dd9c36e978dabaf826a5f46b5525aaaa.png" height="90">
</div>
<div class="title">Figure 13. OBV</div>
</div>
<div class="paragraph">
<p>A possible translation of the formula to Pandas would be something like this:</p>
</div>
<div class="listingblock">
<div class="title">calculating OBV signal</div>
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">ua['OBV'] = np.where(
    ua['Close'] &gt; ua['Close'].shift(1), ua['Volume'],
    np.where(ua['Close'] &lt; ua['Close'].shift(1), -ua['Volume'], 0)
).cumsum()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then plotting this with matplolib:</p>
</div>
<div class="listingblock">
<div class="title">OBV chart</div>
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import matplotlib.ticker as ticker

from matplotlib.gridspec import GridSpec
import matplotlib.patches as mpatches
from matplotlib.ticker import FuncFormatter

# GRID TO LOCATE BOTH CHARTS
sto = plt.figure(figsize=(15, 5))
gsp = GridSpec(2, 1, height_ratios=[4, 3], hspace=0)

st1 = sto.add_subplot(gsp[0])
st2 = sto.add_subplot(gsp[1], sharex=st1)

# SHARED X VALUES
thex = np.arange(len(ua))

# PRICE CHART
st1.plot(thex, ys, label='Price', color="blue")
st1.set_title('UNDER ARMOUR STOCK PRICES vs OBV - YTD (OCT-2019 - OCT-2020)')
st1.set_ylabel('PRICE (US Dollars)')
st1.set_yticks(np.arange(np.floor(ys.min()) - 2, np.ceil(ys.max()) + 4, step=2))
st1.grid(axis='x', linestyle='--')

# OBV CHART
st2.plot(thex, ua['OBV'], color='black')

# FUNCTION TO FORMAT MILLIONS
def millions(x, pos):
    'The two args are the value and tick position'
    return '$%1.1fM' % (x * 1e-6)

formatter = FuncFormatter(millions)
st2.yaxis.set_major_formatter(formatter)
st2.xaxis.set_major_formatter(ticker.FuncFormatter(lambda x, pos: ua.iloc[pos, 0]))
st2.grid(axis='x', linestyle='--')
st2.set_ylabel('OBV (M Dollars)')
st2.set_ylim([ua['OBV'].min() - 1000, ua['OBV'].max() + 1000])
plt.show()</code></pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/img/2020/10/chart_stocks/obv.png" alt="obv" width="90%">
</div>
<div class="title">Figure 14. OBV YTD</div>
</div>
<div class="sect2">
<h3 id="resources_7">Resources</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.investopedia.com/articles/active-trading/011815/top-technical-indicators-rookie-traders.asp#volume-on-balance-volume-obv">OBV for rookie traders</a></p>
</li>
<li>
<p><a href="https://www.investopedia.com/terms/o/onbalancevolume.asp">OBV calculation</a></p>
</li>
<li>
<p><a href="https://www.metatrader5.com/es/terminal/help/indicators/volume_indicators/obv">Volume indicators</a></p>
</li>
<li>
<p><a href="https://www.ismaeldelacruz.es/analizando-el-indicador-obv-de-volumen/">Analyzing OBV (Spanish)</a></p>
</li>
<li>
<p><a href="https://stackoverflow.com/questions/52671594/calculating-stockss-on-balance-volume-obv-in-python">StackOverflow: Calculating OBV in Python</a></p>
</li>
<li>
<p><a href="https://matplotlib.org/3.1.0/gallery/ticks_and_spines/custom_ticker1.html">Custom</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="mplfinance">mplfinance</h2>
<div class="sectionbody">
<div class="paragraph">
<p>mplfinance is a matplotlib module specially suited for showing financial data. I didn&#8217;t have the time to play with it fully but it seemed to me a very useful tool if you need to plot financial data very often. To use it in the Jupyter notebook:</p>
</div>
<div class="listingblock">
<div class="title">import mplfinance in the notebook</div>
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import sys
!{sys.executable} -m pip install mplfinance</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example to see how easy is to create financia data, here&#8217;s the required code to show prices (with candlestick mode) and volume chart of the first 50 days. I&#8217;ve also included a couple of trending lines.</p>
</div>
<div class="listingblock">
<div class="title">mplfinance example</div>
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import mplfinance as mpl

# it requires the index to be a time series
ua['Date'] = pd.to_datetime(ua['Date'])

mpl.figure()

# adjusting overall styles
style = mpl.make_mpf_style(
    y_on_right=False,
    base_mpf_style='yahoo',
    gridaxis='vertical',
    edgecolor='#666666',
    gridstyle=':')


data = ua.set_index('Date').iloc[0:50]
# almost everything happens within the plot() function
mpl.plot(
    data, # first 30 days
    type='candle',
    volume=True,
    title='UA PRICE AND VOLUME CHARTS (OCT-DEC 2019)',
    style=style,
    figratio=(11,8),
    figscale=0.85,
    figsize=(15, 6),
    mav=(),
    tlines=[
        dict(tlines=[('2019-11-06', '2019-11-13')], colors='r'),
        dict(tlines=[('2019-12-03', '2019-12-08'), ('2019-12-12', '2019-12-18')], colors='g')
    ])

mpl.show()</code></pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/img/2020/10/chart_stocks/mplfinance.png" alt="mplfinance" width="90%">
</div>
<div class="title">Figure 15. mplfinance example</div>
</div>
<div class="paragraph">
<p>As you can see the required number of lines is really low compared to previous examples. I think it&#8217;s worth spending a little bit more time with it in the future.</p>
</div>
<div class="sect2">
<h3 id="resources_8">Resources</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://medium.com/@shivangisareen/for-anyone-using-jupyter-notebook-installing-packages-18a9468d0c1c">Installing packages in a Python Jupyter notebook</a></p>
</li>
<li>
<p><a href="https://github.com/matplotlib/mplfinance">mplfinance in Github</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="other_resources">Other Resources</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="article_source_code">Article source code</h3>
<div class="ulist">
<ul>
<li>
<p>Jupyter notebook: <a href="/files/2020/10/chart_stocks/ua_analysis.ipynb">ua_analysis.ipynb</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="financial">Financial</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://finance.yahoo.com/">Yahoo Finance</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="pandas">Pandas</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://towardsdatascience.com/trading-toolbox-02-wma-ema-62c22205e2a9">Weighted vs Exponential moving averages</a></p>
</li>
<li>
<p><a href="https://towardsdatascience.com/trading-technical-analysis-with-pandas-43e737a17861">Trading technical analysis with Pandas</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="matplotlib">Matplotlib</h3>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/matplotlib/mplfinance">Matplot Financial Module</a></p>
</li>
<li>
<p><a href="https://stackoverflow.com/questions/22511550/gridspec-with-shared-axes-in-python">Shared Axes with GridSpec</a></p>
</li>
<li>
<p><a href="https://matplotlib.org/3.1.1/api/_as_gen/matplotlib.gridspec.GridSpec.html#matplotlib.gridspec.GridSpec">GridSpec API</a></p>
</li>
</ul>
</div>
</div>
</div>
</div></yieldScaped></section>
                </div>
            </div><div id="sidebar">
                <div class="inner">
                    <!--Menu--><nav id="menu">
                        <header class="major">
                            <h2>Menu</h2>
                        </header><ul>
                            <li>
                                <a href="/index.html">Latests entries</a>
                            </li><li>
                                <a href="/archive.html">Archive</a>
                            </li><li>
                                <a href="/about.html">About</a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div><script src="/js/jquery.min.js"></script>
            <script src="/js/browser.min.js"></script>
            <script src="/js/breakpoints.min.js"></script>
            <script src="/js/util.js"></script>
            <script src="/js/main.js"></script>
            <script src="/js/highlight.pack.js"></script>
            <script type="text/javascript">
                
        document.addEventListener('DOMContentLoaded', (event) => {
            document.querySelectorAll('pre code').forEach((block) => {
                hljs.highlightBlock(block);
            });
        });
    
            </script>
        </div>
    </body>
</html>
