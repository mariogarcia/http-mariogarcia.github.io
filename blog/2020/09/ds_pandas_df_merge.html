<!DOCTYPE html><html lang="en">
    <head>
<meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0 user-scalable=no"/>
        <title>Working in Progress</title>
        <link rel="stylesheet" href="/css/main.css"/>
        <link rel="stylesheet" href="/css/zenburn.css"/>
        
        
    </head><body class="is-preload">
        <div id="wrapper">
            <div id="main">
                <div class="inner">
                    <header id="header">
                        <a href="/index.html" class="logo">
                            <strong>
                                WORKING IN PROGRESS
                            </strong> - POST
                        </a><ul class="icons">
                            <li>
                                <a href="/feed.xml" class="icon fa-rss">
                                    <span class="label">
                                        Twitter
                                    </span>
                                </a>
                            </li><li>
                                <a href="https://twitter.com/marioggar" class="icon fa-twitter">
                                    <span class="label">
                                        Twitter
                                    </span>
                                </a>
                            </li><li>
                                <a href="https://github.com/mariogarcia" class="icon fa-github">
                                    <span class="label">
                                        Github
                                    </span>
                                </a>
                            </li>
                        </ul>
                    </header><section><header class="main"><div class="metadata"><em class="fa fa-calendar-o"></em><b>2020-09-08</b></div><h1>DS - Pandas - Merging DataFrames</h1></header><yieldScaped><div id="preamble">
<div class="sectionbody">
<div class="imageblock text-center">
<div class="content">
<img src="/img/2020/09/ds_pandas_df_merge/magic_join.png" alt="magic_join">
</div>
</div>
<div class="paragraph">
<p>This is part of a series of articles dedicated to study Data Science using Python. This article
shows a couple of basic examples on DataFrame merging.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="one_is_easy_two_or_more_arenormal">One is easy, two or more are&#8230;&#8203;normal?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>That&#8217;s true, more than often you have to deal with more than one data source in order to get some insight about the problem you want to tackle. Maybe you can transform your source files in order to get just one file, but most of the time you can&#8217;t or is very time consuming.</p>
</div>
<div class="paragraph">
<p>Instead of doing that, you can create Pandas DataFrames and then merge those DataFrames with some logic in order to get the result that you wanted. Most of the time you will want to either concatenate data or join data.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="appending">Appending</h2>
<div class="sectionbody">
<div class="paragraph">
<p>So basically we want more than one DataFrame and we&#8217;d like to concatenate them in just one.</p>
</div>
<div class="sect2">
<h3 id="rows">Rows</h3>
<div class="paragraph">
<p>The easiest use case is when we&#8217;ve got two files with the same format (same columns, and type of data) and we want to concatenate both files one after the other. Here we have two DataFrames, both with the same type of data.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/img/2020/09/ds_pandas_df_merge/concatenate.png" alt="concatenate" height="250">
</div>
</div>
<div class="listingblock">
<div class="title">concatenate rows from two DataFrames</div>
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">df1 = pd.DataFrame([{"name": "john", "age": 22}, {"name": "peter", "age": 34}])
df2 = pd.DataFrame([{"name": "anna", "age": 34}, {"name": "uri", "age": 43}])

result = pd.concat([df1, df2])
result

all_data = pd.concatenate(data_2018, data_2019)
all_data</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Concatenating rows</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">age</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">john</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">22</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">peter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">34</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">anna</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">34</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uri</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">43</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Now <strong>all_data</strong> has all the rows from both DataFrames but <strong>notice how indexes are repeated</strong>. We may want to reset the index for the new DataFrame.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import pandas as pd

df1 = pd.DataFrame([{"name": "john", "age": 22}, {"name": "peter", "age": 34}])
df2 = pd.DataFrame([{"name": "anna", "age": 34}, {"name": "uri", "age": 43}])

result = pd.concat([df1, df2]).reset_index(drop=True)
result</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Resetting index</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">age</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">john</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">22</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">peter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">34</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">anna</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">34</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">uri</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">43</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="columns">Columns</h3>
<div class="paragraph">
<p>For example, think of a series of files, each file represents a part of the whole data and you&#8217;d like to have everything in just one DataFrame. So basic assumption is, there&#8217;re the same amount of lines in every DataFrame.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/img/2020/09/ds_pandas_df_merge/concatenate_columns.png" alt="concatenate_columns" height="200">
</div>
</div>
<div class="paragraph">
<p>In this occasion we have:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>One DataFrame has the names of the students and the other has the ages of the students.</p>
</li>
<li>
<p>Both DataFrames have the same number of rows</p>
</li>
<li>
<p>Both DataFrames are sorted in a way that rows in one DataFrame match the rows in the other DataFrame so names are ending up matching the right ages.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">appending columns</div>
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">df1 = pd.DataFrame([{"name": "john"}, {"name": "peter"}, {"name": "anna"}, {"name": "uri"}])
df2 = pd.DataFrame([{"age": 22}, {"age": 34}, {"age": 34}, {"age": 43}])

result = pd.\
    concat([df1, df2], axis=1).\
    reset_index(drop=True)

result</code></pre>
</div>
</div>
<div class="paragraph">
<p>This time is not necessary to reset the index as the second DataFrame is using the first DataFrame index.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="joining">Joining</h2>
<div class="sectionbody">
<div class="paragraph">
<p>By joining I mean to merge different datasets together following certain rules. Imaging having students' names and their ids in one dataset and their ids and ages in another and you&#8217;d like to merge them all in just one dataset, matching records in both datasets by their ids.</p>
</div>
<div class="paragraph">
<p>Sometimes there will be ages with ids that don&#8217;t match any record in the other dataset, then, What do we do ?</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Should we discard them ?</p>
</li>
<li>
<p>Should we add them in the merged dataset with missing data ?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Depending on the situation you may want to do the former or the latter.</p>
</div>
<div class="sect2">
<h3 id="inner">Inner</h3>
<div class="paragraph">
<p>When doing inner joins what we try to achieve is to match rows from both DataFrames by something they have in common. It could be the row index, or a row column value.</p>
</div>
<div class="paragraph">
<p>When doing inner join by DataFrame index it seems pretty similar to the appending columns example. Here we are joining datasets by their index, so it loops over all the rows in one dataframe and if the other dataframe has a row with the same index then all columns will be added to the next row in the new DataFrame.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Remember that in Pandas DataFrame, by default a DataFrame has a numerical index that begins with integer 0 and follows an incremental sequence.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>So bottom line is it will merge all rows with the same index.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">df1 = pd.DataFrame([{"name": "john"}, {"name": "peter"}, {"name": "anna"}, {"name": "uri"}])
df2 = pd.DataFrame([{"age": 22}, {"age": 34}, {"age": 34}, {"age": 43}])

merged = pd.merge(df1, df2, left_index=True, right_index=True)
merged</code></pre>
</div>
</div>
<div class="paragraph">
<p>See how I&#8217;m telling the <strong>merge</strong> function to use indexes in both DataFrames to do the join. You can change this in order to chose which DataFrame&#8217;s index has to be used to do the join.</p>
</div>
<div class="paragraph">
<p>But there&#8217;re plenty of times when different datasets don&#8217;t have their records in the same order or the index they&#8217;re store doesn&#8217;t correspond to their identity. Moreover their ids are values in one of the columns of the DataFrame. Basically like in a database table with a primary key.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/img/2020/09/ds_pandas_df_merge/inner_join.png" alt="inner_join" height="200">
</div>
</div>
<div class="listingblock">
<div class="title">inner join by column</div>
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">df1 = pd.DataFrame([
    {"id": 1, "name": "john"},
    {"id": 2, "name": "peter"},
    {"id": 3, "name": "anna"}])
df2 = pd.DataFrame([
    {"id": 1, "age": 22},
    {"id": 2, "age": 34},
    {"id": 3, "age": 34},
    {"id": 4, "age": 43}])

merged = pd.merge(df1, df2, how="inner", on="id")
merged</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Inner Join with missing rows</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">age</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">john</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">22</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">peter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">34</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">anna</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">34</p></td>
</tr>
</tbody>
</table>
<div class="ulist">
<ul>
<li>
<p>The <strong>merge</strong> method is invoked with <strong>how="inner"</strong> to tell the function not to add a row if both DataFrames don&#8217;t have a row with the same matching key (<strong>on="id"</strong>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We can see that because there&#8217;s no <strong>"id": 4</strong> in the left DataFrame, we cannot match any record in the second DataFrame, therefore the result doesn&#8217;t have 4 rows but only 3. This works pretty much as a relational database inner join.</p>
</div>
</div>
<div class="sect2">
<h3 id="outer">Outer</h3>
<div class="paragraph">
<p>With the inner join approach we were discarding some rows if the column&#8217;s value didn&#8217;t match. But what if we wanted to add rows not matching the key ? What would happen ? Lets review the previous example, but instead of using inner join, we&#8217;re using <strong>outer</strong> as the joining strategy.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/img/2020/09/ds_pandas_df_merge/outer_join.png" alt="outer_join" height="200">
</div>
</div>
<div class="listingblock">
<div class="title">outer join</div>
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">df1 = pd.DataFrame([
    {"id": 1, "name": "john"},
    {"id": 2, "name": "peter"},
    {"id": 3, "name": "anna"}])
df2 = pd.DataFrame([
    {"id": 1, "age": 22},
    {"id": 2, "age": 34},
    {"id": 3, "age": 34},
    {"id": 4, "age": 43}])

merged = pd.merge(df1, df2, how="outer", on="id")
merged</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Outer Join with Nan values</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">age</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">john</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">22</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">peter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">34</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">anna</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">34</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nan</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">43</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="completing_data">Completing data</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There&#8217;s another scenario where you can have two DataFrames and one of them is like a master table that could be use to complete information in the other DataFrame.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/img/2020/09/ds_pandas_df_merge/completing_data.png" alt="completing_data" height="200">
</div>
</div>
<div class="paragraph">
<p>Imaging there&#8217;s a reference of Formula 1 circuits, and another DataFrame having the drivers that have participated in a specific race, and we want to know how many kilometers did the drivers.</p>
</div>
<div class="listingblock">
<div class="title">getting all relevant information altogether</div>
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">circuits = pd.DataFrame({"circuit": ["Monza", "Spa"], "length": [5, 4]})
drivers  = pd.DataFrame([
    {"name": "Lewis Hamilton", "circuit": "Spa", "laps": 53},
    {"name": "Carlos Sainz", "circuit": "Spa", "laps": 43}])

circuits_drivers = pd.merge(circuits, drivers, how="right", on="circuit")
circuits_drivers</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Completing driver information for Spa</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">circuit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">length</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">laps</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Spa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lewis Hamilton</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">53</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Spa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Carlos Sainz</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">53</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">getting km per pilot</div>
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">circuits_drivers["km"] = circuits_drivers["laps"] * circuits_drivers["length"]
spa_stats = circuits_drivers.\
    drop(["circuit", "length"], axis=1, inplace=False)
spa_stats</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. KM by drivers in SPA</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">laps</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">km</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lewis Hamilton</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">53</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">212</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Carlos Sainz</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">43</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">172</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>These are very basic examples of concatenating, and merging DataFrames, there&#8217;s a section only for that matter in the Pandas site, check links in the <a href="#resources">Resources</a> section:</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="resources">Resources</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://pandas.pydata.org/docs/user_guide/merging.html">Pandas docs: Merge, join, concatenate</a></p>
</li>
</ul>
</div>
</div>
</div></yieldScaped></section>
                </div>
            </div><div id="sidebar">
                <div class="inner">
                    <!--Menu--><nav id="menu">
                        <header class="major">
                            <h2>Menu</h2>
                        </header><ul>
                            <li>
                                <a href="/index.html">Latests entries</a>
                            </li><li>
                                <a href="/archive.html">Archive</a>
                            </li><li>
                                <a href="/stats.html">Statistics</a>
                            </li><li>
                                <a href="/about.html">About</a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div><script src="/js/jquery.min.js"></script>
            <script src="/js/browser.min.js"></script>
            <script src="/js/breakpoints.min.js"></script>
            <script src="/js/util.js"></script>
            <script src="/js/main.js"></script>
            <script src="/js/highlight.pack.js"></script>
            <script type="text/javascript">
                
        document.addEventListener('DOMContentLoaded', (event) => {
            document.querySelectorAll('pre code').forEach((block) => {
                hljs.highlightBlock(block);
            });
        });
    
            </script>
        </div>
    </body>
</html>
