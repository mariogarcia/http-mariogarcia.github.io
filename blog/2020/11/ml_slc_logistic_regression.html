<!DOCTYPE html><html lang="en">
    <head>
<meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0 user-scalable=no"/>
        <title>Working in Progress</title>
        <link rel="stylesheet" href="/css/main.css"/>
        <link rel="stylesheet" href="/css/zenburn.css"/>
        
        
    </head><body class="is-preload">
        <div id="wrapper">
            <div id="main">
                <div class="inner">
                    <header id="header">
                        <a href="/index.html" class="logo">
                            <strong>
                                WORKING IN PROGRESS
                            </strong> - POST
                        </a><ul class="icons">
                            <li>
                                <a href="/feed.xml" class="icon fa-rss">
                                    <span class="label">
                                        Twitter
                                    </span>
                                </a>
                            </li><li>
                                <a href="https://twitter.com/marioggar" class="icon fa-twitter">
                                    <span class="label">
                                        Twitter
                                    </span>
                                </a>
                            </li><li>
                                <a href="https://github.com/mariogarcia" class="icon fa-github">
                                    <span class="label">
                                        Github
                                    </span>
                                </a>
                            </li>
                        </ul>
                    </header><section><header class="main"><div class="metadata"><em class="fa fa-calendar-o"></em><b>2020-11-14</b></div><h1>Logistic Regression: firewall rules</h1></header><yieldScaped><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Although <strong>Logistic regression</strong> is a regression technique, due to the logistic function applied to it, it can constraint target values from a linear regression into discrete values and therefore act as a classification technique. Why not using KNN classification ? Well as a regression technique <strong>it benefits from regularization</strong>, so for a huge number of features it could reduce dimensionality.</p>
</div>
<div class="paragraph">
<p>There are <strong>three types of logistic regression</strong>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>binary</strong>: only two possible target values</p>
</li>
<li>
<p><strong>multinomial</strong>: several possible target values without ordering</p>
</li>
<li>
<p><strong>ordinal</strong>: several possible target values with a specific ordering</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="classifying_firewall_rules">Classifying firewall rules</h2>
<div class="sectionbody">
<div class="paragraph">
<p>I&#8217;m practicing Binary Logistic Regression with UCI&#8217;s <a href="http://archive.ics.uci.edu/ml/datasets/Internet+Firewall+Data">Internet Firewall Data</a> which is a data set collected from the internet traffic records on a university&#8217;s firewall. <a href="http://archive.ics.uci.edu/ml/datasets.php">UCI datasets</a> are sorted depending on whether they&#8217;re good candidates for regression, classification or for both. In this ocassion I&#8217;d like to classify a set of firewall rules into two target values <strong>allowed</strong> or <strong>not allowed</strong>. Lets load the data and see how it looks:</p>
</div>
<div class="listingblock">
<div class="title">loading and simplifying data</div>
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import pandas as pd

firewall = pd.read_csv('firewall.csv')

# simplifying dataframe column names
firewall.columns = [
    'source',
    'destination',
    'nat_source',
    'nat_destination',
    'action',
    'b_total',
    'b_sent',
    'b_received',
    'packets',
    'time',
    'p_sent',
    'p_received'
]

firewall.head()</code></pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/img/2020/11/ml_slc_logistic_regression/dataset_source.png" alt="source" width="90%">
</div>
</div>
<div class="paragraph">
<p>Because I&#8217;d like to do a binary classification, I need to narrow down the multi-valued column <strong>action</strong>:</p>
</div>
<div class="listingblock">
<div class="title">action has several possible values</div>
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">firewall['action'].unique()</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">array(['allow', 'drop', 'deny', 'reset-both'], dtype=object)</code></pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s why I&#8217;m creating the <strong>allowed</strong> column with only two possible values <strong>1 for allow</strong> and <strong>0 for the rest</strong>:</p>
</div>
<div class="listingblock">
<div class="title">create label column</div>
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python"># simplifying actions to allowed or not allowed
firewall['allowed'] = firewall['action'].apply(lambda tag: 1 if tag == 'allow' else 0)
firewall            = firewall.drop('action', axis=1)
firewall.head()</code></pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/img/2020/11/ml_slc_logistic_regression/dataset_with_allowed.png" alt="allowed" width="90%">
</div>
</div>
<div class="paragraph">
<p>As usual, first I&#8217;d like to see the correlation matrix to see which features are the best to use in the logistic regression training:</p>
</div>
<div class="listingblock">
<div class="title">correlation matrix</div>
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import seaborn as sns
import numpy as np
import matplotlib.pyplot as plt

corr_matrix = np.corrcoef(firewall.T)

plt.figure(figsize=(10, 10))
sns.heatmap(
    corr_matrix,
    cbar=False,
    annot=True,
    square=True,
    xticklabels=firewall.columns,
    yticklabels=firewall.columns)</code></pre>
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/img/2020/11/ml_slc_logistic_regression/correlation_matrix.png" alt="matrix" width="40%">
</div>
</div>
<div class="paragraph">
<p>It seems that <strong>nat_source</strong>, <strong>nat_destination</strong> and <strong>time</strong> have the highest rates. With that in mind, I can now create <strong>X</strong> and <strong>y</strong> variables and the <strong>training and test sets</strong>:</p>
</div>
<div class="listingblock">
<div class="title">features and training/test sets</div>
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from sklearn.model_selection import train_test_split

label    = 'allowed'
features = ['nat_source', 'nat_destination', 'time']

X = firewall[features]
y = firewall[label]

X_train, X_test, y_train, y_test = train_test_split(X, y, random_state=50)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Because <strong>there are several features working in different scales</strong> (e.g. time, ports) it would be better to apply some <strong>normalization</strong> to the feature set, in other words, I need to transform them to a common scale. For that I&#8217;m using the <strong>MinMaxScaler</strong> transformation.</p>
</div>
<div class="listingblock">
<div class="title">scaling features</div>
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from sklearn.preprocessing import MinMaxScaler

# needed to reduce complexity
# https://stackoverflow.com/questions/62658215/convergencewarning-lbfgs-failed-to-converge-status-1-stop-total-no-of-iter
scaler         = MinMaxScaler()
X_train_scaled = scaler.fit_transform(X_train)
X_test_scaled  = scaler.transform(X_test)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now I can fit the <strong>LogisticRegression</strong> class with the training scaled dataset, check the score for training and test set, and see how well the model performs.</p>
</div>
<div class="listingblock">
<div class="title">applying regression</div>
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from sklearn.linear_model import LogisticRegression

logistic = LogisticRegression().fit(X_train_scaled, y_train)
logistic.score(X_train_scaled, y_train), logistic.score(X_test_scaled, y_test)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which returns the following scores:</p>
</div>
<div class="listingblock">
<div class="title">scores</div>
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">(0.9711489552178071, 0.9730818531404505)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally I&#8217;m picking the first two samples with different <strong>allowed</strong> value to see if the prediction works:</p>
</div>
<div class="listingblock">
<div class="title">checking sample</div>
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">validation_test_set = (firewall
    .drop_duplicates(subset='allowed', keep="first")
    .copy()
    .reset_index(drop=True))

validation_test_x = validation_test_set.loc[:, features]
validation_test_y = validation_test_set.loc[:, label]

validation_test_x_scaled = scaler.transform(validation_test_x)

logistic.predict(validation_test_x_scaled) == [1, 0]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Unfortunately this is not a good proof, these two samples were already part of the training or test datasets. As a reminder for my future self I should be keeping some part of the source dataset away from the training/test datasets to do a more serious validation at the end of the process.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="resources">Resources</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="/files/2020/11/ml_slc_logistic_regression/logistic_regression_firewall.ipynb">Jupyter notebook of the article&#8217;s source</a></p>
</li>
<li>
<p><a href="https://en.wikipedia.org/wiki/Logistic_regression">Logistic Regression (Wikipedia)</a></p>
</li>
<li>
<p><a href="https://towardsdatascience.com/logistic-regression-detailed-overview-46c4da4303bc">Logistic Regression: Detailed Overview (article)</a></p>
</li>
<li>
<p><a href="http://archive.ics.uci.edu/ml/datasets/Internet+Firewall+Data">UCI&#8217;s Internet Firewall Data dataset</a></p>
</li>
</ul>
</div>
</div>
</div></yieldScaped></section>
                </div>
            </div><div id="sidebar">
                <div class="inner">
                    <!--Menu--><nav id="menu">
                        <header class="major">
                            <h2>Menu</h2>
                        </header><ul>
                            <li>
                                <a href="/index.html">Latests entries</a>
                            </li><li>
                                <a href="/archive.html">Archive</a>
                            </li><li>
                                <a href="/about.html">About</a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div><script src="/js/jquery.min.js"></script>
            <script src="/js/browser.min.js"></script>
            <script src="/js/breakpoints.min.js"></script>
            <script src="/js/util.js"></script>
            <script src="/js/main.js"></script>
            <script src="/js/highlight.pack.js"></script>
            <script type="text/javascript">
                
        document.addEventListener('DOMContentLoaded', (event) => {
            document.querySelectorAll('pre code').forEach((block) => {
                hljs.highlightBlock(block);
            });
        });
    
            </script>
        </div>
    </body>
</html>
