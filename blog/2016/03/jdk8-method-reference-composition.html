<!DOCTYPE html><html lang="en">
    <head>
<meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0 user-scalable=no"/>
        <title>Working in Progress</title>
        <link rel="stylesheet" href="/css/main.css"/>
        <link rel="stylesheet" href="/css/zenburn.css"/>
        
        
    </head><body class="is-preload">
        <div id="wrapper">
            <div id="main">
                <div class="inner">
                    <header id="header">
                        <a href="/index.html" class="logo">
                            <strong>
                                WORKING IN PROGRESS
                            </strong> - POST
                        </a><ul class="icons">
                            <li>
                                <a href="/feed.xml" class="icon fa-rss">
                                    <span class="label">
                                        Twitter
                                    </span>
                                </a>
                            </li><li>
                                <a href="https://twitter.com/marioggar" class="icon fa-twitter">
                                    <span class="label">
                                        Twitter
                                    </span>
                                </a>
                            </li><li>
                                <a href="https://github.com/mariogarcia" class="icon fa-github">
                                    <span class="label">
                                        Github
                                    </span>
                                </a>
                            </li>
                        </ul>
                    </header><section><header class="main"><div class="metadata"><em class="fa fa-calendar-o"></em><b>2016-03-28</b></div><h1>Java: Method Reference composition</h1></header><yieldScaped><div class="sect2">
<h3 id="introduction">Introduction</h3>
<div class="paragraph">
<p>Since JDK 8 there is the <strong>java.util.function</strong> package responsible to
abstract everything that has to do with functions. Most of the time
you will find yourself creating your own functions but sometimes, if
you&#8217;re aware of <strong>method references</strong> you will find out that many of
those functions you were about to create were already in the jdk, or
at least you will be able to use function composition to create new
ones.</p>
</div>
</div>
<div class="sect2">
<h3 id="silly_example">Silly example</h3>
<div class="paragraph">
<p>Lets say we would like to sum two numbers and then add ten to the
result and finally return the result as a <strong>String</strong>. Ok a first naive
implementation would be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public static String doStuff(Integer a, Integer b) {
    Integer sumResult = a + b + 10;

    return sumResult.toString();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s just horrible, everything mixed up, we cannot reuse
anything. Although we can create a lambda expression to represent a
sum, there&#8217;s no need for that. You can use the <code>Integer::sum</code> method
reference that can exactly do that. The problem is that you can&#8217;t do
something like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">// THIS WON'T COMPILE
(Integer::sum).andThen((Integer a) -&gt; a + 10).andThen(Object::toString);</code></pre>
</div>
</div>
<div class="paragraph">
<p>But the solution is very close. We can create a pair of utility
functions receiving a <strong>Function</strong> or a <strong>BiFunction</strong> to <strong>"catch"</strong>
the method reference and use it like any of these type of
functions. Here are the utility functions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">/**
 * Utility function to convert a method reference to a
 * {@link Function}
 *
 * @param fn method reference matching a {@link Function}
 * @return the matching {@link Function}
 */
public static &lt;A,B&gt; Function&lt;A,B&gt; use(Function&lt;A,B&gt; fn) {
    return fn;
}

/**
 * Utility function to convert a method reference to a
 * {@link BiFunction}
 *
 * @param fn method reference matching a {@link BiFunction}
 * @return the matching {@link BiFunction}
 */
public static &lt;A,B,C&gt; BiFunction&lt;A,B,C&gt; use(BiFunction&lt;A,B,C&gt; fn) {
    return fn;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And then you can, for example, compose functions with <code>andThen</code> flavor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public static String doMoreStuff(Integer a, Integer b) {
    BiFunction&lt;Integer,Integer,String&gt; fn = use(Integer::sum)
        .andThen(x -&gt; x + 10)
        .andThen(Object::toString);

    return fn.apply(a,b);
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>andThen</code> seems to be more familiar to imperative programmers
because it follows a logical path: <strong>first this, and then that, and
then that&#8230;&#8203;</strong>. It describes a sequence of events.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Or using <code>compose</code> flavor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public static String doEvenMoreStuff(Integer a, Integer b) {
    Function&lt;Integer,String&gt; extras =
        use(Object::toString).compose((Integer x) -&gt; x + 10); <i class="conum" data-value="1"></i><b>(1)</b>

    BiFunction&lt;Integer,Integer,String&gt; fn =
        use(Integer::sum).andThen(extras); <i class="conum" data-value="2"></i><b>(2)</b>

    return fn.apply(a,b);
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Composing functions using <code>compose</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Applying previous composed functions after the result of the <strong>sum</strong> function</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>compose</code> is the type of composition you could find in languages
as Haskell where the composition evaluation is read from right to
left (first function is the one in the right hand side).
</td>
</tr>
</table>
</div>
</div></yieldScaped></section>
                </div>
            </div><div id="sidebar">
                <div class="inner">
                    <!--Menu--><nav id="menu">
                        <header class="major">
                            <h2>Menu</h2>
                        </header><ul>
                            <li>
                                <a href="/index.html">Latests entries</a>
                            </li><li>
                                <a href="/archive.html">Archive</a>
                            </li><li>
                                <a href="/about.html">About</a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div><script src="/js/jquery.min.js"></script>
            <script src="/js/browser.min.js"></script>
            <script src="/js/breakpoints.min.js"></script>
            <script src="/js/util.js"></script>
            <script src="/js/main.js"></script>
            <script src="/js/highlight.pack.js"></script>
            <script type="text/javascript">
                
        document.addEventListener('DOMContentLoaded', (event) => {
            document.querySelectorAll('pre code').forEach((block) => {
                hljs.highlightBlock(block);
            });
        });
    
            </script>
        </div>
    </body>
</html>
