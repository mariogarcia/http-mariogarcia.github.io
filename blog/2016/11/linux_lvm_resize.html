<!DOCTYPE html><html lang="en">
    <head>
<meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0 user-scalable=no"/>
        <title>Working in Progress</title>
        <link rel="stylesheet" href="/css/main.css"/>
        <link rel="stylesheet" href="/css/zenburn.css"/>
        
        
    </head><body class="is-preload">
        <div id="wrapper">
            <div id="main">
                <div class="inner">
                    <header id="header">
                        <a href="/index.html" class="logo">
                            <strong>
                                WORKING IN PROGRESS
                            </strong> - POST
                        </a><ul class="icons">
                            <li>
                                <a href="https://twitter.com/marioggar" class="icon fa-twitter">
                                    <span class="label">
                                        Twitter
                                    </span>
                                </a>
                            </li><li>
                                <a href="https://github.com/mariogarcia" class="icon fa-github">
                                    <span class="label">
                                        Github
                                    </span>
                                </a>
                            </li>
                        </ul>
                    </header><section><header class="main"><div class="metadata"><em class="fa fa-calendar-o"></em><b>2016-11-16</b></div><h1>Linux LVM: Resize logical volumes (ext4)</h1></header><yieldScaped><div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>One of the most (if not the most) important reasons you might end
using LVM is the ability to resize volumes. In this entry I&#8217;ll be
covering only the task of resizing <code>logical volumes</code> (LV) with <code>ext4</code>
filesystems.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Why <code>EXT4</code> ? We&#8217;ll because it&#8217;s easy. Other filesystems require
at least two manual steps. If you don&#8217;t match blocks or sizes between
these two steps, you could ruin your data.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="initial_state">Initial State</h2>
<div class="sectionbody">
<div class="paragraph">
<p>I&#8217;ve created two <code>logical volumes</code>: <code>books</code> and <code>music</code>, but it turns
out, I&#8217;m running out of space in the <code>music</code> volume whereas I still
have plenty of space in <code>books</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">user@computer&gt; sudo lvs
  LV          VG        Attr       LSize   Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  books       mymedia   -wi-a-----  14.39g
  music       mymedia   -wi-a-----  14.39g</code></pre>
</div>
</div>
<div class="paragraph">
<p>Both logical volumes belong to the <code>mymedia</code> volume group. The problem
is that both logical volumes took all the <code>volume group</code> space. That
forces me to shrink one volume in favor of the other. I think I&#8217;ll be
giving 'music` 5GB from <code>books</code>.</p>
</div>
<div class="sect2">
<h3 id="first_umount_the_fs">First umount the FS</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">user@computer&gt; sudo umount /dev/mymedia/books</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="shrink">Shrink</h3>
<div class="paragraph">
<p>There&#8217;s always a rule of thumb you must follow when resizing your
logical volumes, to reduce the underlying file system first. You can
do that manually and take the risk of losing your data or just use one
single command to do both resizing the filesystem and resizing the
logical volume at once with <code>lvresize</code>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Please, please, please, don&#8217;t forget to add <code>--resizefs</code> to
the following command.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">user@computer&gt; sudo lvresize --resizefs -L-5GB /dev/mymedia/books
fsck from util-linux 2.28.2
/dev/mapper/mymedia-books: clean, 11/944704 files, 85936/3772416 blocks
resize2fs 1.43.3 (04-Sep-2016)
Resizing the filesystem on /dev/mapper/mymedia-books to 2461696 (4k) blocks.
The filesystem on /dev/mapper/mymedia-books is now 2461696 (4k) blocks long.

  Size of logical volume mymedia/books changed from 14.39 GiB (3684 extents) to 9.39 GiB (2404 extents).
  Logical volume mymedia/books successfully resized.</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>--resizefs</code>: Use resize2fs to reduce the underlying filesystem</p>
</li>
<li>
<p><code>-L-5GB</code>: Reduces in 5GB the actual size.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It&#8217;s important to notice the <code>-</code> or <code>+</code> between the <code>L</code> and
<code>5GB</code>. If the volume is 10GB and you write <code>-L 5GB</code> the final size of
the <code>logical volume</code> will be <code>5GB whereas if you write `-L-1GB</code> the
final size will be 4GB. The same goes for the <code>+</code> (increment)
operator.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Then if I list the logical volumes of <code>mymedia</code> I should see that
<code>books</code> now has 9.39GB.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">user@computer&gt; sudo lvs mymedia
  LV    VG      Attr       LSize  Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  books mymedia -wi-a-----  9.39g
  music mymedia -wi-a----- 14.39g</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="extend">Extend</h3>
<div class="paragraph">
<p>We&#8217;ll be using the same <code>lvresize</code> command, but this time instead of
shrinking 5GB (<code>-L-5GB</code>) I would like to increment
<code>/dev/mymedia/music</code> 5GB (<code>-L+5GB</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">user@computer&gt; sudo lvresize --resizefs -L+5GB /dev/mymedia/music
fsck from util-linux 2.28.2
/dev/mapper/mymedia-music: clean, 11/944704 files, 85936/3772416 blocks
  Size of logical volume mymedia/music changed from 14.39 GiB (3684 extents) to 19.39 GiB (4964 extents).
  Logical volume mymedia/music successfully resized.
resize2fs 1.43.3 (04-Sep-2016)
Resizing the filesystem on /dev/mapper/mymedia-music to 5083136 (4k) blocks.
The filesystem on /dev/mapper/mymedia-music is now 5083136 (4k) blocks long.</code></pre>
</div>
</div>
<div class="paragraph">
<p>And in the end I will end up having the following layout:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-shell" data-lang="shell">user@computer&gt; sudo lvs mymedia
  LV    VG      Attr       LSize  Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
  books mymedia -wi-a-----  9.39g
  music mymedia -wi-a----- 19.39g</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="references">References</h3>
<div class="paragraph">
<p>The following references show both automatic and manual resizing of an
<code>ext4</code> filesystem on LVM in Linux.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://www.systutorials.com/124416/shrinking-a-ext4-file-system-on-lvm-in-linux/">Shrink an ext4 File System on LVM in Linux</a></p>
</li>
<li>
<p><a href="http://www.systutorials.com/5621/extending-a-mounted-ext4-file-system-on-lvm-in-linux/">Extend a mounted ext4 file system on LVM in Linux</a></p>
</li>
</ul>
</div>
</div>
</div>
</div></yieldScaped></section>
                </div>
            </div><div id="sidebar">
                <div class="inner">
                    <!--Menu--><nav id="menu">
                        <header class="major">
                            <h2>Menu</h2>
                        </header><ul>
                            <li>
                                <a href="/index.html">Latests entries</a>
                            </li><li>
                                <a href="/archive.html">Archive</a>
                            </li><li>
                                <a href="/about.html">About</a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div><script src="/js/jquery.min.js"></script>
            <script src="/js/browser.min.js"></script>
            <script src="/js/breakpoints.min.js"></script>
            <script src="/js/util.js"></script>
            <script src="/js/main.js"></script>
            <script src="/js/highlight.pack.js"></script>
            <script type="text/javascript">
                
        document.addEventListener('DOMContentLoaded', (event) => {
            document.querySelectorAll('pre code').forEach((block) => {
                hljs.highlightBlock(block);
            });
        });
    
            </script>
        </div>
    </body>
</html>
