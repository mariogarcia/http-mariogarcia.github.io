<!DOCTYPE html><html lang="en">
    <head>
<meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0 user-scalable=no"/>
        <title>Working in Progress</title>
        <link rel="stylesheet" href="/css/main.css"/>
        <link rel="stylesheet" href="/css/zenburn.css"/>
        
        
    </head><body class="is-preload">
        <div id="wrapper">
            <div id="main">
                <div class="inner">
                    <header id="header">
                        <a href="/index.html" class="logo">
                            <strong>
                                WORKING IN PROGRESS
                            </strong> - POST
                        </a><ul class="icons">
                            <li>
                                <a href="/feed.xml" class="icon fa-rss">
                                    <span class="label">
                                        Twitter
                                    </span>
                                </a>
                            </li><li>
                                <a href="https://twitter.com/marioggar" class="icon fa-twitter">
                                    <span class="label">
                                        Twitter
                                    </span>
                                </a>
                            </li><li>
                                <a href="https://github.com/mariogarcia" class="icon fa-github">
                                    <span class="label">
                                        Github
                                    </span>
                                </a>
                            </li>
                        </ul>
                    </header><section><header class="main"><div class="metadata"><em class="fa fa-calendar-o"></em><b>2021-03-24</b></div><h1>Model Evaluation: Decision functions</h1></header><yieldScaped><div id="preamble">
<div class="sectionbody">
<div class="imageblock text-center">
<div class="content">
<img src="/img/2021/03/ml_confusion_matrix/header.png" alt="ConfusionAndMatrix" width="100%">
</div>
</div>
<div class="paragraph">
<p>Another tool for evaluating a classifier are decision functions. Decision functions <strong>show you how a given classifier is classifying positive and negative samples depending on a specific threshold value</strong>. Knowing the threshold and the score of each sample can help you deciding whether or not to raise or decrease the threshold in order to vary the classification behavior towards recall or precision.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="decision_functions_and_threshold">Decision functions and threshold</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image right"><img src="/img/2021/03/ml_decision_functions/decision_function.png" alt="decision function" height="300"></span></p>
</div>
<div class="paragraph">
<p>In a binary classification problem a decision function could be thought as <strong>a simple function deciding whether a given sample  lies within the positive class or the negative class</strong>. They do that by having a threshold value as a reference, anything above or equal to that threshold is considered positive, whereas anything below that threshold is considered negative.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="taiwanese_bankruptcy">Taiwanese bankruptcy</h2>
<div class="sectionbody">
<div class="paragraph">
<p>I&#8217;m using a <a href="https://www.kaggle.com/fedesoriano/company-bankruptcy-prediction">dataset from Kaggle</a> about company bankruptcy
prediction. After preparing the data, I came up with these three classifiers parametrized:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">from sklearn.linear_model import LogisticRegression
from sklearn.tree import DecisionTreeClassifier
from sklearn.neighbors import KNeighborsClassifier

log = LogisticRegression(C=1).fit(X_train, y_train)
knn = KNeighborsClassifier(n_neighbors=5).fit(X_train, y_train)
dtc = DecisionTreeClassifier(max_depth=6).fit(X_train, y_train)</code></pre>
</div>
</div>
<div class="paragraph">
<p>I&#8217;d like to know how they perform in terms of precision-recall scoring depending on different classification thresholds.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title"><strong>missing decision_function</strong> in some Scikit-learn classifiers</div>
<div class="paragraph">
<p>Normally there are two functions sklearn classifiers use in order to return the score and the threshold used to classify
samples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>decision_function</p>
</li>
<li>
<p>predict_proba</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>While <strong>decision_function</strong> returns only the score that represents how probable is that the sample is a positive match, the
<strong>predict_proba</strong> returns both the pobability that the sample is a positive match and the probability that it&#8217;s a negative
match.</p>
</div>
<div class="paragraph">
<p><strong>Not all classifiers support both functions</strong> so it&#8217;s important to bear that in mind when evaluating a set of different classifiers
alltogether.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>I&#8217;d like to get predicted values from every classifier, to because I&#8217;m not sure which one has <strong>decision_function</strong> or <strong>predict_proba</strong> I&#8217;ve created the following function to help me out:</p>
</div>
<div class="listingblock">
<div class="title">decion_function vs predict_proba</div>
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">def get_y_predict(clsf, samples):
    dec_fun = getattr(clsf, 'decision_function', None)
    if dec_fun:
        return clsf.decision_function(samples)
    else:
        # only interested in positive score
        return clsf.predict_proba(samples)[0:, 1:]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now I&#8217;m drawing what is called a precision-recall curve, which shows how the precision and the recall evolve depending on
the threshold value used each time. This can help me choosing a specific threshold depending on what I&#8217;d like to prioritize
precision or recall, or maybe a balance between both.</p>
</div>
<div class="paragraph">
<p>In this example, I&#8217;d like to highlight where precision and recall values are for a threshold of 0.75:</p>
</div>
<div class="listingblock">
<div class="title">Plotting precision-recall curve</div>
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">import numpy as np
from sklearn.metrics import precision_recall_curve
import matplotlib.pyplot as plt

# threshold I'm interested in
THRESHOLD = 0.75

plt.figure()
_, ax = plt.subplots(1, 3, figsize=(15, 4))
cols  = 0

# plotting precision-recall charts
for classifier in lst:
    y_predict = get_y_predict(classifier, X_test)
    precision, recall, thresholds = precision_recall_curve(y_test, y_predict)
    ax[cols].title.set_text(str(type(classifier).__name__))
    ax[cols].set(xlabel='Precision', ylabel='Recall')
    ax[cols].step(precision, recall)
    criteria = np.argmin(np.abs(thresholds - THRESHOLD))
    ax[cols].plot(precision[criteria], recall[criteria], 'o', c='r')
    ax[cols].grid(axis='both', linestyle='--', c='#cccccc')
    cols+=1

plt.show()</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is how the precision-recall curves look like for every classifier:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/img/2021/03/ml_decision_functions/precision_recall_curves.png" alt="precision recall curves">
</div>
</div>
<div class="paragraph">
<p>Now, keeping in mind that <strong>here my goal is to maximize the recall</strong>, that is, to detect as many companies likely to go down to avoid investing in them for example, the classifier I&#8217;d choose is the <strong>KNeighborsClassifier as it reaches the highest recall</strong>. In these charts <strong>I&#8217;ve highlighted with a red point the precision/recall point for a threshold of 0.75</strong>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<strong>Also notice that the ideal point for a classifier would be the top right at (1.0, 1.0)</strong> that is the point where precision and recall would be maximized.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="resources">Resources</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://www.kaggle.com/fedesoriano/company-bankruptcy-prediction">Taiwanese bankrupcy prediction</a>: from Kaggle</p>
</li>
<li>
<p><a href="https://towardsdatascience.com/fine-tuning-a-classifier-in-scikit-learn-66e048c21e65">Fine Tuning Scikit-learn classifiers Article</a>: from Towards Data Science site</p>
</li>
<li>
<p><a href="/files/2021/03/ml_decision_functions/taiwan.ipynb">taiwan.ipynb</a>: Taiwanese companies bankruptcy notebook</p>
</li>
</ul>
</div>
</div>
</div></yieldScaped></section>
                </div>
            </div><div id="sidebar">
                <div class="inner">
                    <!--Menu--><nav id="menu">
                        <header class="major">
                            <h2>Menu</h2>
                        </header><ul>
                            <li>
                                <a href="/index.html">Latests entries</a>
                            </li><li>
                                <a href="/archive.html">Archive</a>
                            </li><li>
                                <a href="/stats.html">Statistics</a>
                            </li><li>
                                <a href="/about.html">About</a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div><script src="/js/jquery.min.js"></script>
            <script src="/js/browser.min.js"></script>
            <script src="/js/breakpoints.min.js"></script>
            <script src="/js/util.js"></script>
            <script src="/js/main.js"></script>
            <script src="/js/highlight.pack.js"></script>
            <script type="text/javascript">
                
        document.addEventListener('DOMContentLoaded', (event) => {
            document.querySelectorAll('pre code').forEach((block) => {
                hljs.highlightBlock(block);
            });
        });
    
            </script>
        </div>
    </body>
</html>
