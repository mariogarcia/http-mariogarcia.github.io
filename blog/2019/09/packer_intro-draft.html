<!DOCTYPE html><html lang="en">
    <head>
<meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0 user-scalable=no"/>
        <title>Working in Progress</title>
        <link rel="stylesheet" href="/css/main.css"/>
        <link rel="stylesheet" href="/css/zenburn.css"/>
        
        
    </head><body class="is-preload">
        <div id="wrapper">
            <div id="main">
                <div class="inner">
                    <header id="header">
                        <a href="/index.html" class="logo">
                            <strong>
                                WORKING IN PROGRESS
                            </strong> - POST
                        </a><ul class="icons">
                            <li>
                                <a href="https://twitter.com/marioggar" class="icon fa-twitter">
                                    <span class="label">
                                        Twitter
                                    </span>
                                </a>
                            </li><li>
                                <a href="https://github.com/mariogarcia" class="icon fa-github">
                                    <span class="label">
                                        Github
                                    </span>
                                </a>
                            </li>
                        </ul>
                    </header><section><header class="main"><h1>Packer by Hashicorp</h1></header><yieldScaped><div class="sect2">
<h3 id="about_packer">About Packer</h3>
<div class="paragraph">
<p>Packer is an open source tool for creating identical machine images for multiple
platforms from a single source configuration. One of the worst things I
have to do when creating a new VM is to go through the installation process
as I were doing it in a physical machine. Moreover, if you had to do it
for different platforms (Vagrant, Xen, KVM) you have to do it n times more.
Packer tries to automate all this process.</p>
</div>
</div>
<div class="sect2">
<h3 id="packer_builders">Packer builders</h3>
<div class="paragraph">
<p>A builder in Packer describes how the image is going to be built for a
specific platform (AWS EC2, KVM, Docker&#8230;&#8203;). For instance, in this post I&#8217;m only
using the Qemu builder because I need to use the image in a KVM
environment.</p>
</div>
</div>
<div class="sect2">
<h3 id="a_simple_debian_machine_for_kvm">A simple Debian machine for KVM</h3>
<div class="paragraph">
<p>My hello world example with Packer is to build a Debian 10 VM for Qemu environment.
Here is Packer configuration file.</p>
</div>
<div class="listingblock">
<div class="title">json configuration</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "variables": {
        "user": "admindebian",
        "password": "admindebian",
        "disk_size": "10000",
        "memory": "2048",
        "ssh_timeout": "12m",
        "boot_wait": "10s"
    },
    "builders":
    [
        {
            "type": "qemu",
            "name": "buster",
            "format": "qcow2",
            "accelerator": "kvm",
            "headless": true,
            "output_directory": "out",

            "iso_checksum": "3dbb597b7f11dbda71cda08d4c1339c1eb565e784c75409987fa2b91182d9240",
            "iso_checksum_type": "sha256",
            "iso_url": "https://cdimage.debian.org/debian-cd/current/amd64/iso-cd/debian-10.0.0-amd64-netinst.iso",

            "memory": "{{user `memory`}}",
            "disk_interface": "virtio",
            "disk_size": "{{ user `disk_size` }}",
            "net_device": "virtio-net",

            "ssh_username": "{{user `user`}}",
            "ssh_password": "{{user `password`}}",
            "ssh_timeout": "{{user `ssh_timeout`}}",
            "shutdown_command": "echo '{{user `password`}}'|sudo -S shutdown -h now",

            "http_directory": "http",
            "boot_wait": "{{user `boot_wait`}}",
            "boot_command": [
                "&lt;esc&gt;&lt;wait&gt;&lt;wait&gt;",
                "install ",

                "auto=true ",
                "priority=critical ",
                "interface=auto ",
                "url=http://{{ .HTTPIP }}:{{ .HTTPPort }}/debian-10.cfg ",

                "passwd/user-fullname={{ user `user` }} ",
                "passwd/user-password={{ user `password` }} ",
                "passwd/user-password-again={{ user `password` }} ",
                "passwd/username={{ user `user` }} ",

                "&lt;enter&gt;"
            ]
        }
    ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The most important blocks are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>variables</strong>: variable declaration. You can declare variables and default values and reference
those variables along the rest of the configuration using the expression <code>{{ user `nameofthevariable</code> }} "`</p>
</li>
<li>
<p><strong>builders</strong>: As I mentioned in the beggining a builder represents the way in which the image machine
is going to be built in a given environment (qemu in here)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="preseed_files">Preseed files</h3>
<div class="listingblock">
<div class="title">preseed file</div>
<div class="content">
<pre class="highlight"><code class="language-properties" data-lang="properties">something/la=pascual</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="packer_provisioners">Packer provisioners</h3>
<div class="paragraph">
<p>TODO</p>
</div>
</div>
<div class="sect2">
<h3 id="references">References</h3>
<div class="ulist">
<ul>
<li>
<p>Packer <a href="https://www.packer.io/intro/">website</a></p>
</li>
</ul>
</div>
</div></yieldScaped></section>
                </div>
            </div><div id="sidebar">
                <div class="inner">
                    <!--Menu--><nav id="menu">
                        <header class="major">
                            <h2>Menu</h2>
                        </header><ul>
                            <li>
                                <a href="/index.html">Latests entries</a>
                            </li><li>
                                <a href="/archive.html">Archive</a>
                            </li><li>
                                <a href="/about.html">About</a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div><script src="/js/jquery.min.js"></script>
            <script src="/js/browser.min.js"></script>
            <script src="/js/breakpoints.min.js"></script>
            <script src="/js/util.js"></script>
            <script src="/js/main.js"></script>
            <script src="/js/highlight.pack.js"></script>
            <script type="text/javascript">
                
        document.addEventListener('DOMContentLoaded', (event) => {
            document.querySelectorAll('pre code').forEach((block) => {
                hljs.highlightBlock(block);
            });
        });
    
            </script>
        </div>
    </body>
</html>
